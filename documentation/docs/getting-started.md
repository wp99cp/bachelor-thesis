# Getting Started

This is the documentation for my bachelor thesis. It contains all the information needed to reproduce the results.

## Folder Structure / Data Organization

The data organization is crucial for the project. As we are working on three different machines (desktop, cluster, and
laptop), each machine uses a slightly different folder structure. Thus make sure to export the environment variables
before starting.

### In general there are the following folders:

- `data`: used to store the data (e.g. training sets, raw data, annotations, etc.)
    - `raw`: used to store the raw data (this is just a partial clone of the pf file server)
    - `annotated_masks`: used to store hand annotated masks
    - `masks`: used to store autogenerated masks
    - `dataset`: used to store the dataset for training
- `results`: here the results are stored (e.g. model checkpoints, tensorboard logs, etc.)
- `tmp`: used to sore some temporary files (non-persistent)
- `backup`: used for temporary local backups

### Getting Started on Different Devices

Please execute the following command before starting:

::: details Working with pf-pc20

Here all data associated with the project is stored within the `/projects/bachelor-thesis` folder.

```bash
# project base directory
export BASE_DIR=/scratch2/pucyril/bachelor-thesis

# used to store the data (e.g. training sets, annotations, etc.)
export DATA_DIR=$BASE_DIR/data
export DATA_RAW_DIR=$DATA_DIR/raw
export ANNOTATED_MASKS_DIR=$DATA_DIR/annotated_masks
export MASKS_DIR=$DATA_DIR/masks
export DATASET_DIR=$DATA_DIR/dataset

export RAW_DATA_REMOTE_DIR=/home/pf/pfstud/nimbus/download_data

# here the results are stored (e.g. model checkpoints, tensorboard logs, etc.)
export RESULTS_DIR=$BASE_DIR/results

# used to sore some temporary files (non-persistent)
export TMP_DIR=$BASE_DIR/tmp
export EXTRACTED_RAW_DATA=$BASE_DIR/tmp

# cleanup
find $TMP_DIR -type f ! -name '.gitignore' -delete
find $TMP_DIR -type d -empty -delete
```

:::

::: details Working with Laptop

Here all data associated with the project is stored within the `/projects/bachelor-thesis` folder.

```bash
# mount network shares
sshfs -o default_permissions pucyril@pf-pc20.ethz.ch:/home/pf/pfstud/nimbus /mnt/nimbus

# project base directory
export BASE_DIR=/projects/bachelor-thesis

# used to store the data (e.g. training sets, annotations, etc.)
export DATA_DIR=$BASE_DIR/data
export DATA_RAW_DIR=$DATA_DIR/raw
export ANNOTATED_MASKS_DIR=$DATA_DIR/annotated_masks
export MASKS_DIR=$DATA_DIR/masks
export DATASET_DIR=$DATA_DIR/dataset

export RAW_DATA_REMOTE_DIR=/mnt/nimbus/download_data

# here the results are stored (e.g. model checkpoints, tensorboard logs, etc.)
export RESULTS_DIR=$BASE_DIR/results

# used to sore some temporary files (non-persistent)
export TMP_DIR=$BASE_DIR/tmp
export EXTRACTED_RAW_DATA=$BASE_DIR/tmp

# cleanup
find $TMP_DIR -type f ! -name '.gitignore' -delete
find $TMP_DIR -type d -empty -delete
```

:::

::: details Working with Euler
Here all data management is handled by the ansible scripts.
:::

## Mounting the Server (`pf/pfstudent/nimbus`)

The file server must be mounted via the desktop machine. This is done via SSHFS.

Read-Only Access:

```bash
sshfs -o default_permissions pucyril@pf-pc20.ethz.ch:/home/pf/pfstud/nimbus /mnt/nimbus
```

Read-Write Access:

```bash
sshfs pucyril@pf-pc20.ethz.ch:/home/pf/pfstud/nimbus /mnt/nimbus
```
